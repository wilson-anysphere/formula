// This file is generated by formula-extension-builder. Do not edit.

import * as __formulaExtensionApi from "@formula/extension-api";
function require(specifier) {
  if (specifier === "@formula/extension-api" || specifier === "formula") return __formulaExtensionApi;
  throw new Error(`External module "${String(specifier)}" is not available in the browser extension sandbox`);
}

var __getOwnPropNames = Object.getOwnPropertyNames;
var __require = /* @__PURE__ */ ((x) => typeof require !== "undefined" ? require : typeof Proxy !== "undefined" ? new Proxy(x, {
  get: (a, b) => (typeof require !== "undefined" ? require : a)[b]
}) : x)(function(x) {
  if (typeof require !== "undefined") return require.apply(this, arguments);
  throw Error('Dynamic require of "' + x + '" is not supported');
});
var __commonJS = (cb, mod) => function __require2() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};

// src/util.js
var require_util = __commonJS({
  "src/util.js"(exports, module) {
    "use strict";
    function sumValues(values) {
      let sum = 0;
      if (!Array.isArray(values)) return sum;
      for (const row of values) {
        if (!Array.isArray(row)) continue;
        for (const value of row) {
          if (typeof value === "number" && Number.isFinite(value)) {
            sum += value;
          }
        }
      }
      return sum;
    }
    module.exports = { sumValues };
  }
});

// src/extension.js
var require_extension = __commonJS({
  "src/extension.js"(exports, module) {
    var formula = __require("@formula/extension-api");
    var { sumValues } = require_util();
    var PANEL_ID = "sampleHello.panel";
    var PANEL_TITLE = "Sample Hello Panel";
    var CONNECTOR_ID = "sampleHello.connector";
    var panel = null;
    var panelPromise = null;
    var panelMessageDisposable = null;
    function panelHtml() {
      return `<!doctype html>
<html>
  <body>
    <h1>Sample Hello Panel</h1>
  </body>
</html>`;
    }
    async function getSelectionSum() {
      const selection = await formula.cells.getSelection();
      return sumValues(selection?.values);
    }
    async function ensurePanel(context) {
      const html = panelHtml();
      if (panel) {
        try {
          await panel.webview.setHtml(html);
          return panel;
        } catch (error) {
          panel = null;
          if (panelMessageDisposable) {
            try {
              panelMessageDisposable.dispose();
            } catch {
            }
            panelMessageDisposable = null;
          }
        }
      }
      if (panelPromise) return panelPromise;
      panelPromise = (async () => {
        const created = await formula.ui.createPanel(PANEL_ID, { title: PANEL_TITLE });
        await created.webview.setHtml(html);
        if (!panelMessageDisposable) {
          panelMessageDisposable = created.webview.onDidReceiveMessage((message) => {
            if (message && message.type === "ping") {
              created.webview.postMessage({ type: "pong" }).catch((err) => {
                console.error(err);
              });
            }
          });
          context.subscriptions.push(panelMessageDisposable);
        }
        panel = created;
        context.subscriptions.push(created);
        return created;
      })();
      try {
        return await panelPromise;
      } finally {
        panelPromise = null;
      }
    }
    async function activate(context) {
      context.subscriptions.push(
        await formula.commands.registerCommand("sampleHello.sumSelection", async () => {
          const selection = await formula.cells.getSelection();
          const sum = sumValues(selection?.values);
          await formula.cells.setCell(2, 0, sum);
          await formula.ui.showMessage(`Sum: ${sum}`);
          return sum;
        })
      );
      context.subscriptions.push(
        await formula.commands.registerCommand("sampleHello.openPanel", async () => {
          const created = await ensurePanel(context);
          return created.id;
        })
      );
      context.subscriptions.push(
        await formula.commands.registerCommand("sampleHello.fetchText", async (url) => {
          const doFetch = typeof fetch === "function" ? fetch : formula.network.fetch;
          const response = await doFetch(String(url));
          const text = await response.text();
          await formula.ui.showMessage(`Fetched: ${text}`);
          return text;
        })
      );
      context.subscriptions.push(
        await formula.commands.registerCommand("sampleHello.copySumToClipboard", async () => {
          const sum = await getSelectionSum();
          await formula.clipboard.writeText(String(sum));
          return sum;
        })
      );
      context.subscriptions.push(
        await formula.commands.registerCommand("sampleHello.showGreeting", async () => {
          const greeting = await formula.config.get("sampleHello.greeting");
          const value = typeof greeting === "string" ? greeting : String(greeting ?? "");
          await formula.ui.showMessage(`Greeting: ${value}`);
          return value;
        })
      );
      context.subscriptions.push(
        await formula.functions.register("SAMPLEHELLO_DOUBLE", {
          handler(value) {
            return value * 2;
          }
        })
      );
      context.subscriptions.push(
        await formula.dataConnectors.register(CONNECTOR_ID, {
          async browse(_config, path) {
            if (path) return [];
            return [
              { id: "hello", name: "Hello", type: "table" },
              { id: "world", name: "World", type: "table" }
            ];
          },
          async query() {
            return {
              columns: ["id", "label"],
              rows: [
                [1, "hello"],
                [2, "world"]
              ]
            };
          },
          async testConnection() {
            return { success: true };
          }
        })
      );
      context.subscriptions.push(
        formula.events.onViewActivated(({ viewId }) => {
          if (viewId !== PANEL_ID) return;
          void ensurePanel(context).catch((error) => {
            console.error(error);
          });
        })
      );
    }
    module.exports = {
      activate
    };
  }
});
export default require_extension();
