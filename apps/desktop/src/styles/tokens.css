/*
  Design tokens (CSS variables)
  Source of truth: docs/12-ux-design.md

  Notes:
  - Keep token names stable; prefer adding new tokens over renaming.
  - Theme selection is controlled by setting `data-theme` on <html>.
  - High contrast is supported both via explicit `data-theme="high-contrast"`
    and via OS forced-colors / prefers-contrast media queries.
*/

:root {
  color-scheme: light;

  /* Typography */
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;

  /* Spacing scale */
  --space-0: 0px;
  --space-1: 2px;
  --space-2: 4px;
  --space-3: 6px;
  --space-4: 8px;
  --space-5: 12px;
  --space-6: 16px;

  /* Base surfaces */
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --bg-tertiary: #e8e8e8;

  /*
    Extended surfaces (app chrome)

    These tokens map more directly to the UI mockups (titlebar/ribbon/statusbar)
    so new shell UI can be built without introducing hardcoded colors.
  */
  --bg-app: var(--bg-secondary);
  --bg-surface: #fafafa;
  --bg-elevated: var(--bg-primary);
  --bg-hover: #eeeeee;
  --bg-active: #e4e4e4;
  --bg-inset: #f0f0f0;

  /* Base text */
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --text-tertiary: #8a8a8a;
  --text-muted: var(--text-secondary);

  /* Lines / separators */
  --border: #d4d4d4;
  --border-strong: #c8c8c8;

  /* Brand / interactive */
  --accent: #0066cc;
  /* Hover/active states for solid accent surfaces (primary buttons, File tab, etc). */
  --accent-hover: #006bd6;
  --accent-active: #005cb8;
  --accent-light: #e6f0ff;
  --accent-bg: var(--accent-light);
  --accent-border: var(--accent);
  /* Hyperlinks */
  --link: #0969da;

  /* Semantic */
  --error: #d32f2f;
  --warning: #ed6c02;
  --success: #2e7d32;
  --error-bg: rgba(211, 47, 47, 0.12);
  --warning-bg: rgba(237, 108, 2, 0.12);
  --success-bg: rgba(46, 125, 50, 0.12);

  /* Titlebar (desktop chrome) */
  --titlebar-window-close: #ff5f57;
  --titlebar-window-minimize: #febc2e;
  --titlebar-window-maximize: #28c840;

  /* Text on strong accent backgrounds (buttons, etc.) */
  --text-on-accent: #ffffff;

  /* Selection / focus */
  --selection-bg: var(--accent-bg);
  --selection-border: var(--accent-border);
  --selection-text: var(--text-primary);
  /* Selection fill used for canvas overlays (must be translucent so cell text remains readable). */
  --selection-fill: rgba(0, 102, 204, 0.12);

  /* Grid chrome */
  --grid-header-bg: var(--bg-secondary);
  --grid-header-text: var(--text-primary);
  --grid-line: var(--border);

  /* @formula/grid theme bridge (shared-grid + legacy canvas rendering). */
  --formula-grid-bg: var(--bg-primary);
  --formula-grid-line: var(--grid-line);
  --formula-grid-header-bg: var(--grid-header-bg);
  --formula-grid-header-text: var(--grid-header-text);
  --formula-grid-cell-text: var(--text-primary);
  --formula-grid-link: var(--link);
  --formula-grid-error-text: var(--error);
  --formula-grid-selection-fill: var(--selection-fill);
  --formula-grid-selection-border: var(--selection-border);
  --formula-grid-selection-handle: var(--selection-border);
  --formula-grid-scrollbar-track: var(--bg-tertiary);
  --formula-grid-scrollbar-thumb: var(--text-secondary);
  --formula-grid-freeze-line: var(--border);
  --formula-grid-comment-indicator: var(--warning);
  --formula-grid-comment-indicator-resolved: var(--text-secondary);
  --formula-grid-remote-presence-default: var(--accent);
  /* Remote presence palette (collaboration cursors/selections). */
  --formula-grid-remote-presence-1: #4c8bf5;
  --formula-grid-remote-presence-2: #ff2d55;
  --formula-grid-remote-presence-3: #34c759;
  --formula-grid-remote-presence-4: #ff9500;
  --formula-grid-remote-presence-5: #af52de;
  --formula-grid-remote-presence-6: #5ac8fa;
  --formula-grid-remote-presence-7: #ffcc00;
  --formula-grid-remote-presence-8: #5856d6;
  --formula-grid-remote-presence-9: #ff3b30;
  --formula-grid-remote-presence-10: #00c7be;
  --formula-grid-remote-presence-11: #32ade6;
  --formula-grid-remote-presence-12: #ff6482;

  /* Sheet tab color palette (Excel-like). */
  --sheet-tab-red: #ff0000;
  --sheet-tab-orange: #ff9900;
  --sheet-tab-yellow: #ffff00;
  --sheet-tab-green: #00b050;
  --sheet-tab-teal: #00b0f0;
  --sheet-tab-blue: #0070c0;
  --sheet-tab-purple: #7030a0;
  --sheet-tab-gray: #7f7f7f;

  /* Charts */
  --chart-bg: var(--bg-primary);
  --chart-border: var(--border);
  --chart-axis: var(--text-secondary);
  --chart-title: var(--text-primary);
  --chart-placeholder-bg: var(--bg-secondary);
  --chart-placeholder-border: var(--border);
  --chart-label: var(--text-secondary);

  /* Chart series palette (defaults to Tableau 10-inspired hues). */
  --chart-series-1: #4e79a7;
  --chart-series-2: #f28e2b;
  --chart-series-3: #e15759;
  --chart-series-4: #76b7b2;

  /* Panels / dialogs */
  --panel-bg: var(--bg-secondary);
  --panel-border: var(--border);
  --panel-shadow: -2px 0 10px rgba(0, 0, 0, 0.08);
  --dialog-bg: var(--bg-primary);
  --dialog-border: var(--border);
  --dialog-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
  --dialog-backdrop: rgba(0, 0, 0, 0.4);

  /* Tooltips */
  --tooltip-bg: rgba(17, 24, 39, 0.95);
  --tooltip-text: #ffffff;

  /* Command palette */
  --cmdk-bg: var(--bg-secondary);
  --cmdk-border: var(--border);
  --cmdk-input-bg: var(--bg-tertiary);

  /* Formula bar */
  --formula-bar-bg: var(--bg-secondary);
  --formula-bar-border: var(--border);
  --formula-fn-color: var(--accent);
  --formula-ref-color: #7c3aed;
  --formula-string-color: var(--warning);
  --formula-number-color: var(--success);
  --formula-operator-color: var(--text-primary);
  --formula-punctuation-color: var(--text-secondary);
  --formula-error-color: var(--error);

  /* Shape / depth */
  --radius: 4px;
  --radius-sm: 3px;
  --radius-xs: 2px;
  --shadow-surface: 0 1px 2px rgba(0, 0, 0, 0.08);

  /* Motion */
  --motion-duration: 160ms;
  --motion-duration-fast: 80ms;
  --motion-ease: cubic-bezier(0.2, 0, 0, 1);
}

:root[data-theme="dark"] {
  color-scheme: dark;

  --bg-primary: #1e1e1e;
  --bg-secondary: #252526;
  --bg-tertiary: #333333;

  --bg-app: var(--bg-primary);
  --bg-surface: var(--bg-secondary);
  --bg-elevated: var(--bg-tertiary);
  --bg-hover: #2f2f2f;
  --bg-active: #3a3a3a;
  --bg-inset: var(--bg-primary);

  --text-primary: #e4e4e4;
  --text-secondary: #a0a0a0;
  --text-tertiary: #7a7a7a;

  --border: #404040;
  --border-strong: #5a5a5a;

  --accent: #4da6ff;
  --accent-hover: #51aeff;
  --accent-active: #499ef2;
  --accent-light: #1a3a5c;
  --link: #4da6ff;

  --error: #f44336;
  --warning: #ff9800;
  --success: #4caf50;
  --error-bg: rgba(244, 67, 54, 0.14);
  --warning-bg: rgba(255, 152, 0, 0.14);
  --success-bg: rgba(76, 175, 80, 0.14);

  /* Accent backgrounds in dark are typically light, so dark text reads best. */
  --text-on-accent: #1e1e1e;

  --selection-fill: rgba(77, 166, 255, 0.18);

  --formula-ref-color: #c4b5fd;
  --shadow-surface: 0 1px 2px rgba(0, 0, 0, 0.5);

  --panel-shadow: -2px 0 10px rgba(0, 0, 0, 0.4);
  --tooltip-bg: rgba(0, 0, 0, 0.85);
  --tooltip-text: #ffffff;

  --dialog-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
  --dialog-backdrop: rgba(0, 0, 0, 0.55);
}

:root[data-theme="high-contrast"] {
  /* In explicit high contrast mode, prefer system colors for maximum legibility. */
  color-scheme: light dark;

  --bg-primary: Canvas;
  --bg-secondary: Canvas;
  --bg-tertiary: Canvas;

  --bg-app: Canvas;
  --bg-surface: Canvas;
  --bg-elevated: Canvas;
  --bg-hover: Canvas;
  --bg-active: Canvas;
  --bg-inset: Canvas;

  --text-primary: CanvasText;
  --text-secondary: CanvasText;
  --text-tertiary: CanvasText;

  --border: CanvasText;
  --border-strong: CanvasText;

  --accent: Highlight;
  --accent-hover: Highlight;
  --accent-active: Highlight;
  --accent-light: Highlight;
  --accent-bg: Highlight;
  --accent-border: Highlight;
  --link: LinkText;

  --error: CanvasText;
  --warning: CanvasText;
  --success: CanvasText;
  --error-bg: Highlight;
  --warning-bg: Highlight;
  --success-bg: Highlight;

  --titlebar-window-close: CanvasText;
  --titlebar-window-minimize: CanvasText;
  --titlebar-window-maximize: CanvasText;

  --text-on-accent: HighlightText;
  --selection-text: HighlightText;
  --selection-fill: transparent;

  --panel-shadow: none;
  --shadow-surface: none;
  --tooltip-bg: CanvasText;
  --tooltip-text: Canvas;

  --dialog-shadow: none;
  --dialog-backdrop: transparent;

  --formula-fn-color: var(--accent);
  --formula-ref-color: LinkText;
  --formula-string-color: var(--warning);
  --formula-number-color: var(--success);
  --formula-operator-color: var(--text-primary);
  --formula-punctuation-color: var(--text-secondary);
  --formula-error-color: var(--error);

  /* Remote presence palette (collaboration cursors/selections) should follow system accent colors. */
  --formula-grid-remote-presence-1: var(--accent);
  --formula-grid-remote-presence-2: var(--accent);
  --formula-grid-remote-presence-3: var(--accent);
  --formula-grid-remote-presence-4: var(--accent);
  --formula-grid-remote-presence-5: var(--accent);
  --formula-grid-remote-presence-6: var(--accent);
  --formula-grid-remote-presence-7: var(--accent);
  --formula-grid-remote-presence-8: var(--accent);
  --formula-grid-remote-presence-9: var(--accent);
  --formula-grid-remote-presence-10: var(--accent);
  --formula-grid-remote-presence-11: var(--accent);
  --formula-grid-remote-presence-12: var(--accent);

  /*
    Charts: use system colors so series remain visible/differentiable in high contrast.

    Note: If additional `--chart-series-*` tokens are introduced, they should also be
    mapped to system colors here and in the forced-colors/prefers-contrast override below.
  */
  --chart-series-1: Highlight;
  --chart-series-2: LinkText;
  --chart-series-3: VisitedText;
  --chart-series-4: CanvasText;

  /*
    Workbook chart theme bridge: when a workbook provides its own accent palette we still
    want forced-colors/high-contrast modes to swap those colors to system colors. The
    chart theme uses these as `var(--chart-series-hc-N, <workbook-accentN>)` fallbacks.
  */
  --chart-series-hc-1: var(--chart-series-1);
  --chart-series-hc-2: var(--chart-series-2);
  --chart-series-hc-3: var(--chart-series-3);
  --chart-series-hc-4: var(--chart-series-4);
  --chart-series-hc-5: Mark;
  --chart-series-hc-6: ButtonText;
}

@media (forced-colors: active), (prefers-contrast: more) {
  /*
    Ensure the high-contrast overrides apply even when a concrete theme is set via
    `data-theme` (e.g. user-selected dark mode). The attribute selector matches the
    specificity of `:root[data-theme="dark"]` so these later rules win in the cascade.
  */
  :root,
  :root[data-theme] {
    color-scheme: light dark;

    --bg-primary: Canvas;
    --bg-secondary: Canvas;
    --bg-tertiary: Canvas;

    --bg-app: Canvas;
    --bg-surface: Canvas;
    --bg-elevated: Canvas;
    --bg-hover: Canvas;
    --bg-active: Canvas;
    --bg-inset: Canvas;

    --text-primary: CanvasText;
    --text-secondary: CanvasText;
    --text-tertiary: CanvasText;

    --border: CanvasText;
    --border-strong: CanvasText;

    --accent: Highlight;
    --accent-hover: Highlight;
    --accent-active: Highlight;
    --accent-light: Highlight;
    --accent-bg: Highlight;
    --accent-border: Highlight;
    --link: LinkText;

    --error: CanvasText;
    --warning: CanvasText;
    --success: CanvasText;
    --error-bg: Highlight;
    --warning-bg: Highlight;
    --success-bg: Highlight;

    --titlebar-window-close: CanvasText;
    --titlebar-window-minimize: CanvasText;
    --titlebar-window-maximize: CanvasText;

    --text-on-accent: HighlightText;
    --selection-text: HighlightText;
    --selection-fill: transparent;

    --panel-shadow: none;
    --shadow-surface: none;
    --tooltip-bg: CanvasText;
    --tooltip-text: Canvas;

    --dialog-shadow: none;
    --dialog-backdrop: transparent;

    --formula-fn-color: var(--accent);
    --formula-ref-color: LinkText;
    --formula-string-color: CanvasText;
    --formula-number-color: CanvasText;
    --formula-operator-color: CanvasText;
    --formula-punctuation-color: CanvasText;
    --formula-error-color: CanvasText;

    --formula-grid-remote-presence-1: var(--accent);
    --formula-grid-remote-presence-2: var(--accent);
    --formula-grid-remote-presence-3: var(--accent);
    --formula-grid-remote-presence-4: var(--accent);
    --formula-grid-remote-presence-5: var(--accent);
    --formula-grid-remote-presence-6: var(--accent);
    --formula-grid-remote-presence-7: var(--accent);
    --formula-grid-remote-presence-8: var(--accent);
    --formula-grid-remote-presence-9: var(--accent);
    --formula-grid-remote-presence-10: var(--accent);
    --formula-grid-remote-presence-11: var(--accent);
    --formula-grid-remote-presence-12: var(--accent);

    /* Charts: override palette-based series colors for high contrast. */
    --chart-series-1: Highlight;
    --chart-series-2: LinkText;
    --chart-series-3: VisitedText;
    --chart-series-4: CanvasText;

    --chart-series-hc-1: var(--chart-series-1);
    --chart-series-hc-2: var(--chart-series-2);
    --chart-series-hc-3: var(--chart-series-3);
    --chart-series-hc-4: var(--chart-series-4);
    --chart-series-hc-5: Mark;
    --chart-series-hc-6: ButtonText;
  }
}

/* Explicit hook for runtime detection (e.g., in a canvas renderer). */
:root[data-reduced-motion="true"] {
  --motion-duration: 0ms;
  --motion-duration-fast: 0ms;
  --motion-ease: linear;
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --motion-duration: 0ms;
    --motion-duration-fast: 0ms;
    --motion-ease: linear;
  }
}
