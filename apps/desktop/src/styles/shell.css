/*
  Desktop app-shell styles extracted from `apps/desktop/index.html`.

  This file intentionally avoids hardcoded colors and relies on CSS variables
  defined in `tokens.css` (enforced by `noHardcodedColors.test.js`).
*/

html,
body {
  height: 100%;
  margin: 0;
  font-family: var(--font-sans);
  background: var(--bg-primary);
  color: var(--text-primary);
}

#app {
  height: 100%;
  width: 100%;
  display: grid;
  /* titlebar, ribbon, formula bar, workspace, sheet tabs, status bar */
  grid-template-rows: auto auto auto 1fr auto auto;
  /* Explicit single-column track: avoid implicit `auto` columns sizing to max-content
     (which can introduce horizontal scroll when the ribbon overflows). */
  grid-template-columns: minmax(0, 1fr);
  min-width: 0;
  min-height: 0;
}

/* Utilities */

/* Hidden <input type="color"> elements mounted by main.ts for formatting pickers. */
.shell-hidden-input,
.hidden-color-input {
  position: fixed;
  left: -1000px;
  top: -1000px;
  opacity: 0;
}

/* Grid/flex children can overflow horizontally unless they're allowed to shrink. */
#app > * {
  min-width: 0;
}

/* --- Find/replace + go to dialogs --------------------------------------- */

dialog.find-replace-dialog,
dialog.goto-dialog {
  width: min(680px, 92vw);
  border: 1px solid var(--dialog-border);
  border-radius: var(--radius);
  padding: var(--space-4);
  background: var(--dialog-bg);
  color: var(--text-primary);
  box-shadow: var(--dialog-shadow);
}

dialog.find-replace-dialog::backdrop,
dialog.goto-dialog::backdrop {
  background: var(--dialog-backdrop);
}

/* --- Page setup dialog --------------------------------------------------- */

dialog.page-setup-dialog {
  width: min(520px, calc(100vw - (var(--space-6) * 2)));
  border: 1px solid var(--dialog-border);
  border-radius: var(--radius);
  padding: 0;
  background: var(--dialog-bg);
  color: var(--text-primary);
  box-shadow: var(--dialog-shadow);
}

dialog.page-setup-dialog::backdrop {
  background: var(--dialog-backdrop);
}

/* --- Print preview dialog ------------------------------------------------- */

dialog.print-preview-dialog {
  width: min(1100px, calc(100vw - (var(--space-6) * 2)));
  height: min(820px, calc(100vh - (var(--space-6) * 2)));
  border: 1px solid var(--dialog-border);
  border-radius: var(--radius);
  padding: 0;
  background: var(--dialog-bg);
  color: var(--text-primary);
  box-shadow: var(--dialog-shadow);
}

dialog.print-preview-dialog::backdrop {
  background: var(--dialog-backdrop);
}

.print-preview-dialog__root {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
}

.print-preview-dialog__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4) var(--space-5);
  border-bottom: 1px solid var(--dialog-border);
}

.print-preview-dialog__title {
  font-weight: 700;
}

.dialog__controls.print-preview-dialog__controls {
  margin-top: 0;
}

.print-preview-dialog__viewer {
  flex: 1;
  width: 100%;
  border: none;
  background: var(--bg-primary);
}

.find-replace-dialog .row,
.goto-dialog .row {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-3);
}

.find-replace-dialog__look-in-label {
  margin-left: var(--space-3);
}

.find-replace-dialog__whole-cell-label {
  margin-left: var(--space-4);
}

.find-replace-dialog__close {
  margin-left: auto;
}

.goto-dialog__cancel {
  margin-left: var(--space-3);
}

.find-replace-dialog input[type="checkbox"],
.find-replace-dialog input[type="radio"],
.page-setup-dialog input[type="checkbox"],
.page-setup-dialog input[type="radio"] {
  margin: 0;
  accent-color: var(--accent);
}

.find-replace-dialog input[type="checkbox"]:focus-visible,
.find-replace-dialog input[type="radio"]:focus-visible,
.page-setup-dialog input[type="checkbox"]:focus-visible,
.page-setup-dialog input[type="radio"]:focus-visible {
  outline: var(--space-1) solid var(--selection-border);
  outline-offset: var(--space-1);
}

.find-replace-dialog input[type="text"],
.goto-dialog input[type="text"],
.find-replace-dialog select,
.goto-dialog select {
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-width: 0;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.find-replace-dialog input[type="text"]:focus-visible,
.goto-dialog input[type="text"]:focus-visible,
.find-replace-dialog select:focus-visible,
.goto-dialog select:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 var(--space-1) var(--selection-bg);
}

.find-replace-dialog button,
.goto-dialog button {
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  cursor: pointer;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.find-replace-dialog button:hover:not(:disabled),
.goto-dialog button:hover:not(:disabled) {
  background: var(--bg-hover);
}

.find-replace-dialog button:active:not(:disabled),
.goto-dialog button:active:not(:disabled) {
  background: var(--bg-active);
}

.find-replace-dialog button:focus-visible,
.goto-dialog button:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 var(--space-1) var(--selection-bg);
}

.find-replace-dialog button:disabled,
.goto-dialog button:disabled {
  opacity: 0.5;
  cursor: default;
}

.goto-dialog .error {
  color: var(--error);
  font-size: 12px;
}

.find-results {
  max-height: 240px;
  overflow: auto;
  padding-left: var(--space-6);
  margin: var(--space-2) 0 0;
}

.find-results li {
  cursor: pointer;
  padding: var(--space-1) 0;
}

/* Tighten print preview dialog controls (match find/goto button sizing). */
.print-preview-dialog .dialog__controls button {
  border-radius: var(--radius-sm);
  padding: var(--space-2) var(--space-4);
}

.print-preview-dialog .dialog__controls {
  gap: var(--space-3);
}

/* --- Grid canvas layering ------------------------------------------------ */

.grid-root {
  position: relative;
  width: 100%;
  height: 100%;
  outline: none;
  /* Use grid-scoped tokens so the canvas/DOM overlays can be themed independently of
     the broader application surfaces. */
  background: var(--formula-grid-bg, var(--bg-primary));
  color: var(--formula-grid-cell-text, var(--text-primary));
  user-select: none;
  /* Prevent DOM overlays (charts, scrollbars, outline buttons) from spilling
     outside the grid viewport while we virtualize with negative coordinates. */
  overflow: hidden;
}

.grid-root:focus-visible {
  /* Show a stable keyboard focus ring around the grid region (separate from the
     active-cell selection border) so F6-driven focus cycling has a clear affordance. */
  box-shadow: inset 0 0 0 var(--space-1) var(--formula-grid-selection-border, var(--selection-border));
}

.grid-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

.outline-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.outline-toggle {
  position: absolute;
  pointer-events: auto;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  border: 1px solid var(--formula-grid-line, var(--border));
  background: var(--formula-grid-bg, var(--bg-primary));
  color: var(--formula-grid-cell-text, var(--text-primary));
  border-radius: var(--radius-xs);
  font: 12px/12px var(--font-sans);
  cursor: pointer;
}

.outline-toggle:active {
  background: var(--formula-grid-scrollbar-track, var(--bg-tertiary));
}

.cell-editor {
  position: absolute;
  /* Hidden by default; .cell-editor--open controls visibility. */
  display: none;
  /* Ensure the editor sits above canvas overlay layers (selection, charts, etc),
     especially in shared-grid mode where canvases are explicitly z-indexed. */
  z-index: 10;
  box-sizing: border-box;
  padding: var(--space-1) var(--space-2);
  border: var(--space-1) solid var(--formula-grid-selection-border, var(--selection-border));
  outline: none;
  resize: none;
  font: 14px/20px var(--font-mono);
  background: var(--formula-grid-bg, var(--bg-primary));
  color: var(--formula-grid-cell-text, var(--text-primary));
  overflow: hidden;
}

.cell-editor.cell-editor--open {
  display: block;
}

/* --- Sheet tabs ---------------------------------------------------------- */

/* --- Status bar ---------------------------------------------------------- */

.statusbar {
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  gap: var(--space-0);
  padding: var(--space-1) var(--space-3);
  border-top: 1px solid var(--border);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 12px;
  align-items: stretch;
  min-width: 0;
  /* Never allow status bar contents to introduce page-level horizontal scrolling. */
  overflow-x: hidden;
}

.statusbar:focus-within {
  box-shadow: inset 0 0 0 var(--space-1) var(--selection-border);
}

.statusbar__main {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  gap: var(--space-3);
  min-width: 0;
}

.statusbar__main > * {
  min-width: 0;
}

.statusbar__item {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-secondary);
}

.statusbar__collab {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  min-width: 0;
  max-width: 280px;
}

.statusbar__collab [data-testid="collab-status"] {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.statusbar__collab [data-testid="collab-status"][data-collab-mode="collab"][data-collab-conn="connected"][data-collab-sync="synced"] {
  color: var(--accent);
}

.statusbar__collab [data-testid="collab-status"][data-collab-conn="disconnected"],
.statusbar__collab [data-testid="collab-status"][data-collab-conn="offline"] {
  color: var(--error);
}

.statusbar__collab [data-testid="collab-status"][data-collab-conn="connecting"],
.statusbar__collab [data-testid="collab-status"][data-collab-sync="syncing"],
.statusbar__collab [data-testid="collab-status"][data-collab-conn="loading"] {
  color: var(--warning);
}

.statusbar__spacer {
  flex: 1;
  min-width: 0;
}

.statusbar__debug {
  /*
    Debug/test status elements used by Playwright (active cell, selection range, etc).
    Keep them in the DOM for assertions, but hide them from the production status bar so
    the UI matches an Excel-like layout.
  */
  display: none;
}

.statusbar__debug > div {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-3);
}

.statusbar-mode {
  display: inline-flex;
  align-items: center;
  height: 20px;
  padding: var(--space-0) var(--space-2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-secondary);
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.statusbar-readonly {
  display: inline-flex;
  align-items: center;
  height: 20px;
  padding: var(--space-0) var(--space-2);
  border: 1px solid var(--warning);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--warning);
  font-weight: 600;
  white-space: nowrap;
}

.statusbar code {
  font-family: var(--font-mono);
  color: var(--text-primary);
}

.statusbar button {
  padding: var(--space-0) var(--space-3);
  height: 20px;
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  cursor: pointer;
  font: inherit;
  line-height: 18px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease);
}

.statusbar button:hover:not(:disabled) {
  background: var(--bg-hover);
}

.statusbar button:active:not(:disabled) {
  background: var(--bg-active);
}

.statusbar button:disabled {
  opacity: 0.5;
  cursor: default;
}

.statusbar button:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 var(--space-1) var(--selection-bg);
}

.statusbar select {
  padding: var(--space-0) var(--space-3);
  height: 20px;
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  font: inherit;
  line-height: 18px;
  min-width: 0;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease);
}

.statusbar select:hover:not(:disabled) {
  background: var(--bg-hover);
}

.statusbar select:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 var(--space-1) var(--selection-bg);
}

@media (max-width: 900px) {
  .statusbar [data-testid="selection-sum"],
  .statusbar [data-testid="selection-avg"],
  .statusbar [data-testid="selection-count"] {
    display: none;
  }
}

@media (max-width: 760px) {
  .statusbar__main {
    gap: var(--space-2);
  }

  .statusbar [data-testid="status-zoom"] {
    display: none;
  }

  .statusbar [data-testid="open-version-history-panel"],
  .statusbar [data-testid="open-branch-manager-panel"],
  .statusbar [data-testid="open-marketplace-panel-statusbar"] {
    display: none;
  }

  .statusbar__collab > span:first-child {
    display: none;
  }

  .statusbar__collab {
    max-width: 200px;
  }
}

@media (max-width: 700px) {
  .statusbar__main {
    gap: var(--space-2);
  }

  .statusbar button,
  .statusbar select {
    padding: var(--space-0) var(--space-3);
  }

  /*
    Keep the sheet position live region in the accessibility tree while removing it
    from the visual layout on very narrow widths.
  */
  .statusbar [data-testid="sheet-position"] {
    position: absolute;
    width: calc(var(--space-1) / 2);
    height: calc(var(--space-1) / 2);
    padding: 0;
    margin: calc((var(--space-1) / 2) * -1);
    overflow: hidden;
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
  }
}
