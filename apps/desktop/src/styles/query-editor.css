/*
  Query Editor panel UI (src/panels/query-editor/*).

  This file intentionally uses only design tokens from `tokens.css` and does not
  hardcode colors (enforced by `noHardcodedColors.test.js`).
*/

.query-editor-container {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  min-width: 0;
  background: var(--panel-bg);
  color: var(--text-primary);
  /* Use a container query so the editor can respond to docked panel widths,
     not just the app viewport. */
  container-type: inline-size;
}

.query-editor-container__message {
  padding: 12px;
  color: var(--text-muted);
}

.query-editor-container__engine-warning {
  padding: 12px;
  color: var(--text-primary);
  border-bottom: 1px solid var(--panel-border);
  border-bottom-color: var(--warning);
  background: var(--warning-bg);
  overflow-wrap: anywhere;
  white-space: pre-wrap;
}

.query-editor-container__toolbar {
  padding: 12px;
  border-bottom: 1px solid var(--panel-border);
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  background: var(--panel-bg);
}

.query-editor-container__toolbar select {
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  min-width: 0;
  max-width: 100%;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-container__toolbar select:focus {
  outline: none;
}

.query-editor-container__toolbar select:hover {
  background: var(--bg-hover);
}

.query-editor-container__toolbar select:disabled {
  opacity: 0.5;
  cursor: default;
}

.query-editor-container__toolbar select:disabled:hover {
  background: var(--bg-primary);
}

.query-editor-container__toolbar select:focus-visible {
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

@supports not selector(:focus-visible) {
  .query-editor-container__toolbar select:focus {
    border-color: var(--selection-border);
    box-shadow: 0 0 0 2px var(--selection-bg);
  }

  .query-editor-container__toolbar button:focus,
  .query-editor__sidebar-actions button:focus,
  .query-editor-steps__button:focus,
  .query-editor-add-step__menu-trigger:focus,
  .query-editor-add-step__ai-button:focus,
  .query-editor-add-step__suggestion:focus {
    outline: none;
    border-color: var(--selection-border);
    box-shadow: 0 0 0 2px var(--selection-bg);
  }

  .query-editor-add-step__menu-item:focus {
    outline: none;
    background: var(--selection-bg);
    border-color: var(--selection-border);
    color: var(--selection-text);
  }
}

.query-editor-container__select {
  flex: 0 1 240px;
}

.query-editor-container__source {
  color: var(--text-muted);
  font-size: 12px;
  margin-right: 8px;
  flex: 1 1 220px;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.query-editor-container__refresh-policy {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: var(--text-muted);
  flex: 0 0 auto;
  white-space: nowrap;
}

.query-editor-container__toolbar button {
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-container__toolbar button:hover {
  background: var(--bg-hover);
}

.query-editor-container__toolbar button:active {
  background: var(--bg-active);
}

.query-editor-container__toolbar button:disabled {
  opacity: 0.5;
  cursor: default;
}

.query-editor-container__toolbar button:disabled:hover,
.query-editor-container__toolbar button:disabled:active {
  background: var(--bg-primary);
}

.query-editor-container__toolbar button:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

.query-editor-container__action-error {
  padding: 12px;
  color: var(--error);
  border-bottom: 1px solid var(--panel-border);
  border-bottom-color: var(--error);
  background: var(--error-bg);
  overflow-wrap: anywhere;
  white-space: pre-wrap;
}

.query-editor {
  flex: 1;
  min-height: 0;
  display: grid;
  grid-template-columns: clamp(220px, 30%, 320px) 1fr;
  height: 100%;
  min-width: 0;
}

.query-editor__sidebar {
  border-inline-end: 1px solid var(--panel-border);
  padding: 12px;
  overflow: auto;
  scrollbar-gutter: stable;
  min-width: 0;
  background: var(--panel-bg);
}

.query-editor__title {
  margin-top: 0;
  overflow-wrap: anywhere;
}

.query-editor__sidebar-actions {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.query-editor__sidebar-actions button {
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor__sidebar-actions button:hover {
  background: var(--bg-hover);
}

.query-editor__sidebar-actions button:active {
  background: var(--bg-active);
}

.query-editor__sidebar-actions button:disabled {
  opacity: 0.5;
  cursor: default;
}

.query-editor__sidebar-actions button:disabled:hover,
.query-editor__sidebar-actions button:disabled:active {
  background: var(--bg-primary);
}

.query-editor__sidebar-actions button:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

.query-editor__main {
  display: grid;
  grid-template-rows: auto 1fr;
  overflow: hidden;
  min-width: 0;
  min-height: 0;
  background: var(--bg-primary);
  color: var(--text-primary);
}

.query-editor__schema {
  border-bottom: 1px solid var(--panel-border);
  padding: 12px;
  background: var(--panel-bg);
  scrollbar-gutter: stable;
}

.query-editor__status {
  margin-top: 8px;
  color: var(--text-muted);
  overflow-wrap: anywhere;
  white-space: pre-wrap;
}

.query-editor__error {
  margin-top: 8px;
  padding: 8px 10px;
  border: 1px solid var(--error);
  border-radius: var(--radius);
  background: var(--error-bg);
  color: var(--error);
  overflow-wrap: anywhere;
  white-space: pre-wrap;
}

.query-editor__preview {
  overflow: auto;
  scrollbar-gutter: stable;
  background: var(--bg-primary);
}

.query-editor-schema {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.query-editor-schema__chip {
  display: inline-flex;
  align-items: center;
  font-size: 12px;
  background: var(--bg-tertiary);
  padding: 2px 6px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.query-editor-steps__title {
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 6px;
}

.query-editor-steps__list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.query-editor-steps__button {
  width: 100%;
  text-align: start;
  border: 1px solid transparent;
  background: transparent;
  padding: 6px 8px;
  cursor: pointer;
  border-radius: var(--radius-sm);
  color: inherit;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-steps__button:hover {
  background: var(--bg-hover);
  border-color: var(--border);
}

.query-editor-steps__button:active {
  background: var(--bg-active);
}

.query-editor-steps__button:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

.query-editor-steps__button--selected {
  background: var(--selection-bg);
  border-color: var(--selection-border);
  color: var(--selection-text);
}

.query-editor-add-step {
  margin-bottom: 12px;
}

.query-editor-add-step__menu-trigger {
  width: 100%;
  margin-bottom: 8px;
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  font: inherit;
  text-align: start;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-add-step__menu-popover {
  border: 1px solid var(--border);
  background: var(--bg-elevated);
  border-radius: var(--radius);
  padding: 8px;
  margin-bottom: 8px;
  box-shadow: var(--shadow-surface);
  max-width: 100%;
  box-sizing: border-box;
  max-block-size: min(360px, 50vh);
  overflow: auto;
  scrollbar-gutter: stable;
}

.query-editor-add-step__menu-group {
  margin-bottom: 8px;
}

.query-editor-add-step__menu-group:last-child {
  margin-bottom: 0;
}

.query-editor-add-step__menu-group-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.query-editor-add-step__menu-group-items {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.query-editor-add-step__menu-item {
  width: 100%;
  margin-top: 0;
  text-align: start;
  padding: 6px 8px;
  border: 1px solid transparent;
  border-radius: var(--radius);
  background: transparent;
  color: var(--text-primary);
  cursor: pointer;
  font: inherit;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-add-step__menu-item:hover {
  background: var(--bg-hover);
  border-color: var(--border);
}

.query-editor-add-step__menu-item:active {
  background: var(--bg-active);
}

.query-editor-add-step__menu-item:focus-visible {
  outline: none;
  background: var(--selection-bg);
  border-color: var(--selection-border);
  color: var(--selection-text);
}

.query-editor-add-step__menu-item:disabled {
  color: var(--text-secondary);
  cursor: default;
}

.query-editor-add-step__menu-item:disabled:hover,
.query-editor-add-step__menu-item:disabled:focus-visible {
  background: transparent;
  border-color: transparent;
  color: var(--text-secondary);
}

.query-editor-add-step__menu-hint {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 8px;
}

.query-editor-add-step__ai-input {
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 6px;
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  outline: none;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-add-step__ai-input::placeholder {
  color: var(--text-tertiary);
}

.query-editor-add-step__ai-input:focus {
  outline: none;
}

.query-editor-add-step__ai-input:focus-visible {
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

@supports not selector(:focus-visible) {
  .query-editor-add-step__ai-input:focus {
    border-color: var(--selection-border);
    box-shadow: 0 0 0 2px var(--selection-bg);
  }
}

.query-editor-add-step__ai-button {
  width: 100%;
}

.query-editor-add-step__ai-error {
  margin-top: 6px;
  padding: 6px 8px;
  font-size: 12px;
  border: 1px solid var(--error);
  border-radius: var(--radius);
  background: var(--error-bg);
  color: var(--error);
  overflow-wrap: anywhere;
  white-space: pre-wrap;
}

.query-editor-add-step__menu-trigger,
.query-editor-add-step__ai-button,
.query-editor-add-step__suggestion {
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg-primary);
  color: var(--text-primary);
  cursor: pointer;
  font: inherit;
  transition:
    background-color var(--motion-duration-fast) var(--motion-ease),
    border-color var(--motion-duration-fast) var(--motion-ease),
    color var(--motion-duration-fast) var(--motion-ease),
    box-shadow var(--motion-duration-fast) var(--motion-ease);
}

.query-editor-add-step__menu-trigger:hover,
.query-editor-add-step__ai-button:hover,
.query-editor-add-step__suggestion:hover {
  background: var(--bg-hover);
}

.query-editor-add-step__menu-trigger[aria-expanded="true"],
.query-editor-add-step__menu-trigger[aria-expanded="true"]:hover {
  background: var(--selection-bg);
  border-color: var(--selection-border);
  color: var(--selection-text);
}

.query-editor-add-step__menu-trigger:active,
.query-editor-add-step__ai-button:active,
.query-editor-add-step__suggestion:active {
  background: var(--bg-active);
}

.query-editor-add-step__menu-trigger:disabled,
.query-editor-add-step__ai-button:disabled,
.query-editor-add-step__suggestion:disabled {
  opacity: 0.5;
  cursor: default;
}

.query-editor-add-step__menu-trigger:disabled:hover,
.query-editor-add-step__menu-trigger:disabled:active,
.query-editor-add-step__ai-button:disabled:hover,
.query-editor-add-step__ai-button:disabled:active,
.query-editor-add-step__suggestion:disabled:hover,
.query-editor-add-step__suggestion:disabled:active {
  background: var(--bg-primary);
}

.query-editor-add-step__menu-trigger:focus-visible,
.query-editor-add-step__ai-button:focus-visible,
.query-editor-add-step__suggestion:focus-visible {
  outline: none;
  border-color: var(--selection-border);
  box-shadow: 0 0 0 2px var(--selection-bg);
}

.query-editor-add-step__suggestions {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.query-editor-add-step__no-suggestions {
  font-size: 12px;
  color: var(--text-secondary);
}

.query-editor-add-step__suggestion {
  width: 100%;
  margin-top: 0;
  text-align: start;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.query-editor-preview__empty {
  padding: 12px;
  color: var(--text-secondary);
}

.query-editor-preview__table {
  border-collapse: collapse;
  width: 100%;
  background: var(--bg-primary);
  color: var(--text-primary);
}

.query-editor-preview__th {
  position: sticky;
  top: 0;
  z-index: 1;
  background: var(--grid-header-bg);
  border-bottom: 1px solid var(--panel-border);
  padding: 6px;
  text-align: start;
  font-size: 12px;
  color: var(--grid-header-text);
  font-weight: 600;
}

.query-editor-preview__table tbody tr:hover {
  background: var(--bg-hover);
}

.query-editor-preview__td {
  border-bottom: 1px solid var(--panel-border);
  padding: 6px;
  font-size: 12px;
  vertical-align: top;
  overflow-wrap: anywhere;
}

/* Responsive layout: when docked panels are narrow, stack the sidebar above the
   preview so the main table remains usable. */
@container (max-width: 700px) {
  .query-editor {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
  }

  .query-editor__sidebar {
    border-inline-end: none;
    border-bottom: 1px solid var(--panel-border);
    /* Keep the preview visible when the sidebar content grows. */
    max-block-size: clamp(180px, 35vh, 320px);
  }

  .query-editor__schema {
    /* Prevent large schemas/status blocks from pushing the preview off-screen. */
    max-block-size: clamp(120px, 25vh, 220px);
    overflow: auto;
  }
}

@container (max-width: 520px) {
  .query-editor-container__toolbar {
    padding: 8px;
    gap: 6px;
  }

  .query-editor-container__toolbar select,
  .query-editor-container__toolbar button {
    padding: 4px 8px;
  }

  .query-editor-container__source {
    flex-basis: 100%;
    margin-right: 0;
  }

  .query-editor-container__select {
    flex-basis: 100%;
  }

  .query-editor-container__refresh-policy {
    flex-basis: 100%;
    min-width: 0;
  }

  .query-editor-container__refresh-policy select {
    flex: 1 1 auto;
  }

  .query-editor-container__engine-warning,
  .query-editor-container__action-error {
    padding: 8px;
  }

  .query-editor__sidebar,
  .query-editor__schema {
    padding: 8px;
  }
}

/* Fallback for runtimes without container queries support: approximate the
   responsive behavior using viewport media queries. */
@supports not (container-type: inline-size) {
  @media (max-width: 700px) {
    .query-editor {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
    }

    .query-editor__sidebar {
      border-inline-end: none;
      border-bottom: 1px solid var(--panel-border);
      max-height: clamp(180px, 35vh, 320px);
    }

    .query-editor__schema {
      max-height: clamp(120px, 25vh, 220px);
      overflow: auto;
    }
  }

  @media (max-width: 520px) {
    .query-editor-container__toolbar {
      padding: 8px;
      gap: 6px;
    }

    .query-editor-container__toolbar select,
    .query-editor-container__toolbar button {
      padding: 4px 8px;
    }

    .query-editor-container__source {
      flex-basis: 100%;
      margin-right: 0;
    }

    .query-editor-container__select {
      flex-basis: 100%;
    }

    .query-editor-container__refresh-policy {
      flex-basis: 100%;
      min-width: 0;
    }

    .query-editor-container__refresh-policy select {
      flex: 1 1 auto;
    }

    .query-editor-container__engine-warning,
    .query-editor-container__action-error {
      padding: 8px;
    }

    .query-editor__sidebar,
    .query-editor__schema {
      padding: 8px;
    }
  }
}
